--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--// CONFIG (YOU CAN CHANGE THESE)
local CONFIG = {
	HitboxEnabled = true,
	ESPEnabled = true,

	Range = 6000,           -- ðŸ”¥ MAIN RANGE CONTROL
	HitboxScale = 10,       -- base size
	MaxHitboxSize = 160,    -- hard clamp (safety)

	ToggleKey = Enum.KeyCode.Semicolon, -- ;
}

--// UI
local gui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
gui.Name = "DevHitboxESP"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromOffset(220, 170)
frame.Position = UDim2.fromOffset(20, 200)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local corner = Instance.new("UICorner", frame)

local function makeButton(text, y)
	local b = Instance.new("TextButton", frame)
	b.Size = UDim2.fromOffset(200, 30)
	b.Position = UDim2.fromOffset(10, y)
	b.Text = text
	b.BackgroundColor3 = Color3.fromRGB(45,45,45)
	b.TextColor3 = Color3.new(1,1,1)
	b.Font = Enum.Font.Gotham
	b.TextSize = 14
	Instance.new("UICorner", b)
	return b
end

local hitboxBtn = makeButton("Hitbox: ON", 10)
local espBtn = makeButton("ESP: ON", 50)
local rangeLabel = makeButton("Range: "..CONFIG.Range, 90)

--// BUTTON LOGIC
hitboxBtn.MouseButton1Click:Connect(function()
	CONFIG.HitboxEnabled = not CONFIG.HitboxEnabled
	hitboxBtn.Text = "Hitbox: "..(CONFIG.HitboxEnabled and "ON" or "OFF")
end)

espBtn.MouseButton1Click:Connect(function()
	CONFIG.ESPEnabled = not CONFIG.ESPEnabled
	espBtn.Text = "ESP: "..(CONFIG.ESPEnabled and "ON" or "OFF")
end)

rangeLabel.MouseButton1Click:Connect(function()
	CONFIG.Range += 1000
	if CONFIG.Range > 20000 then
		CONFIG.Range = 2000
	end
	rangeLabel.Text = "Range: "..CONFIG.Range
end)

--// KEYBINDS
UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end

	if input.KeyCode == CONFIG.ToggleKey then
		CONFIG.HitboxEnabled = not CONFIG.HitboxEnabled
		hitboxBtn.Text = "Hitbox: "..(CONFIG.HitboxEnabled and "ON" or "OFF")
	end
end)

--// HITBOX SETUP
local function setupHitbox(character)
	local root = character:WaitForChild("HumanoidRootPart", 5)
	if not root then return end

	local box = Instance.new("Part")
	box.Name = "DevHitbox"
	box.Shape = Enum.PartType.Ball
	box.Anchored = true
	box.CanCollide = false
	box.CanTouch = false
	box.CanQuery = false -- IMPORTANT (no ray blocking)
	box.Material = Enum.Material.ForceField
	box.Color = Color3.fromRGB(255, 0, 0)
	box.Transparency = 0.6
	box.Parent = character

	RunService.RenderStepped:Connect(function()
		if not box.Parent or not root.Parent then return end

		if not CONFIG.HitboxEnabled then
			box.Transparency = 1
			return
		end

		local dist = (Camera.CFrame.Position - root.Position).Magnitude
		if dist > CONFIG.Range then
			box.Transparency = 1
			return
		end

		box.Transparency = 0.6
		box.CFrame = root.CFrame

		local base = math.max(root.Size.X, root.Size.Y, root.Size.Z)
		local distBoost = math.clamp(dist / 400, 1, 2.5)

		local size = base * CONFIG.HitboxScale * distBoost
		size = math.clamp(size, 4, CONFIG.MaxHitboxSize)

		box.Size = Vector3.new(size, size, size)
	end)
end

--// ESP SETUP
local function setupESP(player)
	if player == LocalPlayer then return end

	local billboard = Instance.new("BillboardGui")
	billboard.Size = UDim2.fromOffset(100, 40)
	billboard.AlwaysOnTop = true
	billboard.Name = "DevESP"

	local label = Instance.new("TextLabel", billboard)
	label.Size = UDim2.fromScale(1,1)
	label.BackgroundTransparency = 1
	label.TextColor3 = Color3.new(1,1,1)
	label.TextStrokeTransparency = 0
	label.Font = Enum.Font.GothamBold
	label.TextScaled = true
	label.Text = player.Name

	local function attach(char)
		local head = char:WaitForChild("Head", 5)
		if not head then return end
		billboard.Parent = head
	end

	if player.Character then attach(player.Character) end
	player.CharacterAdded:Connect(attach)

	RunService.RenderStepped:Connect(function()
		if not billboard.Parent then return end
		if not CONFIG.ESPEnabled then
			billboard.Enabled = false
			return
		end

		local char = player.Character
		local root = char and char:FindFirstChild("HumanoidRootPart")
		if not root then return end

		local dist = (Camera.CFrame.Position - root.Position).Magnitude
		billboard.Enabled = dist <= CONFIG.Range
	end)
end

--// PLAYER HANDLING
for _, plr in ipairs(Players:GetPlayers()) do
	if plr ~= LocalPlayer then
		setupESP(plr)
		if plr.Character then
			setupHitbox(plr.Character)
		end
		plr.CharacterAdded:Connect(setupHitbox)
	end
end

Players.PlayerAdded:Connect(function(plr)
	setupESP(plr)
	plr.CharacterAdded:Connect(setupHitbox)
end)
